def mod_int(n):
    if n == 0:
        return '010'
    elif n > 0:
        sign = '01'
    else:
        sign = '10'
        n = -n

    digits = format(n, 'b')
    if (len(digits) % 4) > 0:
        digits = ('0' * (4 - (len(digits) % 4))) + digits
    return sign + ('1' * ((len(digits) + 3) // 4)) + '0' + digits

def mod(o):
    if type(o) is int:
        return mod_int(o)
    elif o == ():
        return '00'
    else:
        return '11' + mod(o[0]) + mod(o[1])

def dem(s):
    i = [0]

    def dem_int():
        neg = (s[i[0]] == '1')
        i[0] += 2

        length = 0
        while s[i[0]] == '1':
            length += 4
            i[0] += 1

        i[0] += 1

        if length == 0:
            return 0

        x = int(s[i[0] : i[0] + length], base = 2)
        i[0] += length

        if neg:
            return -x
        else:
            return x

    def dem_cons():
        i[0] += 2

        a = dem_obj()
        b = dem_obj()

        return (a, b)

    def dem_obj():
        b2 = s[i[0] : i[0] + 2]
        if b2 == '11':
            return dem_cons()
        elif b2 == '00':
            i[0] += 2
            return ()
        else:
            return dem_int()

    return dem_obj()

def test(o):
    print(o, mod(o), dem(mod(o)))

if __name__ == "__main__":
    test((1, 0))
    test((1, (0, ())))

    t0 = (2, (9060619466841888600, ((), ())))
    test(t0)

    s0 = '1101100001110110000111110111100001000000001101100001111101111000011100000011011000011101110010000000011110111000010000110111010000000001100001111010111101110000100001101110100000000011111111011000011101011111011000110000101100010000011110100101111011000101101100010110110001011011000100011010110111001000000110110000100110000111111010110110000111110111000110000011100010000011110100101111011000101101100010110110001011011000100011010110111001000000110110000100110000000000'
    s1 = '1101100001110110000111110111100001000000001101100001111101111000011100000011011000011101110010000000011110111000010000110111010000000001100001111011000101111011100001000011011101000000000111111110110000111010111110110001011011011000100000111101100010010111101100010110110001011011000101101100010001101011011100100000011011000010011000011111101011011000011111011100010110101110001000001111101000100101111011000101101100010110110001011011000100011010110111001000000110110000100110000000000'

    print('s0', dem(s0))
    print('s1', dem(s1))
